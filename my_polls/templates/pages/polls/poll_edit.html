{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% block title %}{% translate "Polls" %}{% endblock title %}
{% block main %}
  {% block content %}
    <nav aria-label="breadcrumb" class="breadcrumb-panel">
      <ol class="breadcrumb mt-3">
        <li class="breadcrumb-item"><a href="{% url 'polls:index' %}">{% translate "Polls" %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'polls:detail' poll.id %}">{{ poll.question|truncatechars:30 }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{% translate "Edit Poll" %}</li>
      </ol>
    </nav>
    <div class="row align-items-center mb-2 g-2">
      <div class="col-12 col-md-auto mb-2 mb-md-0 d-flex justify-content-start">
        <a href="{% url 'polls:detail' poll.id %}" class="btn btn-outline-secondary">&larr; {% translate "Back to Poll Detail" %}</a>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-12 text-center">
        <h1 class="mb-0">{% translate "Poll Edit" %}</h1>
      </div>
    </div>
    <form method="post" class="max-w-400 mx-auto mb-5">
      {% csrf_token %}
      {{ form.question.label_tag }}
      {{ form.question}}
      {{ form.question.errors }}
      <label class="my-3">{% translate "Choices" %}:</label>
      <label class="mt-3">Choices:</label>
      {{ formset.management_form }}
      <div id="formset-container">
        {% for sub_form in formset %}
          <div class="formset-form mb-2">
            {% for hidden_field in sub_form.hidden_fields %}
              {{ hidden_field }}
            {% endfor %}
            {{ sub_form.choice_text}}
            {{ sub_form.choice_text.errors }}
          </div>
        {% endfor %} 
      </div>
      <div class="formset-actions my-4 row">
        <div class="col-md-6">
          <button type="button" id="add-choice-button" class="w-100 btn btn-outline-dark my-2">Add</button>
        </div>
        <div class="col-md-6">
          <button type="button" id="remove-choice-button" class="w-100 btn btn-outline-danger my-2">Remove</button>
        </div>
      </div>
      <div class="mb-3">
        {{ form.is_closed.label_tag }}
        {{ form.is_closed }}
        {{ form.is_closed.errors }}
      </div>
      <button type="submit" class="btn btn-success w-100">{% translate "Save Changes" %}</button>
    </form>
  {% endblock content %}
{% endblock main %}
{% block inline_javascript %}
<script src="{% static 'js/polls/formset_controller.js' %}"></script>
{% endblock inline_javascript %}
